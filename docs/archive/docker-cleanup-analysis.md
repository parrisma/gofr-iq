# gofr-iq docker/ Cleanup Analysis

Generated: 2026-02-24

## Summary

29 files in `docker/`. Of these: 6 REDUNDANT, 3 ORPHANED, 18 ACTIVE, 2 UNCLEAR.

## File Analysis

| File | Status | Reason |
|------|--------|--------|
| `.env` | ACTIVE | Auto-generated by `start-prod.sh`: merges `gofr_ports.env` + Vault secrets + project config. Referenced by compose files (implicit) and `reset-prod.sh` (deletes it). Contains actual secret (`NEO4J_PASSWORD`). |
| `.env.example` | ACTIVE | Template for manual setup; referenced in docs (`gofr_iq_auth_upgrade_implementation_plan.md`). Harmless to keep. |
| `.vault-init.env.example` | ORPHANED | Not referenced by any script, compose file, or documentation. Vault bootstrap is now handled by `lib/gofr-common/scripts/bootstrap_platform.sh`. |
| `Dockerfile.chromadb` | ACTIVE | Used by `build-chromadb.sh` and `build-all.sh`. gofr-iq-specific (no equivalent in gofr-common). |
| `Dockerfile.dev` | ACTIVE | Used by `build-dev.sh` and `build-all.sh`. Project-specific: extends `gofr-base` with gofr-iq paths, copies gofr-iq's `entrypoint-dev.sh`. Not a duplicate of `lib/gofr-common/docker/Dockerfile.dev` (that one targets gofr-common itself). |
| `Dockerfile.neo4j` | ACTIVE | Used by `build-neo4j.sh` and `build-all.sh`. gofr-iq-specific (no equivalent in gofr-common). |
| `Dockerfile.prod` | ACTIVE | Used by `build-prod.sh` and `build-all.sh`. gofr-iq-specific production image. |
| `backup.sh` | ACTIVE | Called by `manage-infra.sh` (backup/backup-list/restore actions). gofr-iq-specific (Neo4j + ChromaDB backup logic). |
| `build-all.sh` | ACTIVE | Orchestrator; called by `start-prod.sh`. Invokes `build-base.sh`, `build-chromadb.sh`, `build-neo4j.sh`, `build-dev.sh`, `build-prod.sh`. |
| `build-base.sh` | ACTIVE | Tags `gofr-base:latest` as `gofr-iq-base:latest`. Different purpose from `lib/gofr-common/docker/build-base.sh` (which actually builds the base image from Dockerfile.base). Called by `build-all.sh`. |
| `build-chromadb.sh` | ACTIVE | Builds `gofr-iq-chromadb` image. Called by `build-all.sh` and `start-test-env.sh`. |
| `build-dev.sh` | ACTIVE | Builds `gofr-iq-dev` image. Called by `build-all.sh`, `bootstrap_gofr_iq.sh`, docs. |
| `build-neo4j.sh` | ACTIVE | Builds `gofr-iq-neo4j` image. Called by `build-all.sh` and `start-test-env.sh`. |
| `build-prod.sh` | ACTIVE | Builds `gofr-iq-prod` image. Called by `build-all.sh`, `start-test-env.sh`, `bootstrap_gofr_iq.sh`, docs. |
| `compose.dev.yml` | ACTIVE | Test/dev compose stack (ephemeral). Used by `manage-infra.sh --test`. Canonical test compose file. |
| `compose.prod.yml` | ACTIVE | Production compose stack. Used by `stop-prod.sh`, `manage-infra.sh`, `manage_servers.sh`, `dump_environment.sh`, `entrypoint-prod.sh` comments. |
| `docker-compose.yml` | REDUNDANT | **Byte-identical** to `compose.prod.yml`. Old naming convention. Still referenced by `docs/getting-started.md`, `check_version_compatibility.py`, `restart_servers.sh` (gofr-common), and several doc files -- but all operational scripts now use `compose.prod.yml`. Should be removed and stale references updated. |
| `docker-compose-test.yml` | REDUNDANT | **Byte-identical** to `compose.dev.yml`. Old naming convention. Only referenced in stale comments in `run_tests.sh` and doc files. All operational code uses `compose.dev.yml` via `manage-infra.sh`. Should be removed and stale references updated. |
| `entrypoint-chromadb.sh` | ACTIVE | Used by `Dockerfile.chromadb` COPY + ENTRYPOINT. gofr-iq-specific (backup-on-startup logic). |
| `entrypoint-dev.sh` | ACTIVE | Used by `Dockerfile.dev` (COPY to `/entrypoint.sh`). Project-specific: sets `PROJECT_DIR` to gofr-iq, installs gofr-common submodule, manages iq-specific dirs. Not a duplicate of `lib/gofr-common/docker/entrypoint-dev.sh` (that one targets gofr-common paths). |
| `entrypoint-neo4j.sh` | ACTIVE | Used by `Dockerfile.neo4j` COPY + ENTRYPOINT. gofr-iq-specific (backup-on-startup logic). |
| `entrypoint-prod.sh` | ACTIVE | Used by `Dockerfile.prod` and `compose.prod.yml`. gofr-iq-specific (AppRole credential setup). |
| `entrypoint-vault.sh` | REDUNDANT | Near-identical to `lib/gofr-common/docker/entrypoint-vault.sh` (only cosmetic diffs: "GOFR-IQ" vs "GOFR Shared", config path). **Not referenced by any Dockerfile or compose file in gofr-iq.** Vault is now built from `lib/gofr-common/docker/Dockerfile.vault` which copies the common version. |
| `manage-infra.sh` | ACTIVE | Central infrastructure orchestrator. Called by `start-test-env.sh`, `run_tests.sh` (indirectly), docs. |
| `reset-prod.sh` | ACTIVE | Nuke-and-pave script. Referenced in docs. |
| `start-prod.sh` | ACTIVE | Main production startup script. Extensively referenced in docs, readme, and bootstrap scripts. |
| `stop-prod.sh` | ACTIVE | Stops production stack. Referenced in docs and copilot-instructions. |
| `vault-config.hcl` | REDUNDANT | Near-identical to `lib/gofr-common/docker/vault-config.hcl` (cosmetic diffs only: comment text, whitespace alignment). **Not referenced by any Dockerfile or compose file in gofr-iq.** Vault image is built from common's `Dockerfile.vault` which copies the common version. |
| `vault-config.json` | REDUNDANT | JSON equivalent of `vault-config.hcl`. Not referenced by any script, Dockerfile, or compose file. Redundant with both the local `.hcl` and the common `.hcl`. |

## Detailed Comparison of "Near-Identical" Files

### vault-config.hcl (local vs common)
- Local: comment says "GOFR-IQ", common says "GOFR (shared)"
- Whitespace differences in `api_addr`/`cluster_addr`/`ui`/`disable_mlock` alignment
- Functionally identical configuration

### entrypoint-vault.sh (local vs common)
- Local: banner says "GOFR-IQ Vault Container", config path `/vault/gofr-config.hcl`
- Common: banner says "GOFR Shared Vault", config path `/vault/config/vault.hcl`
- Same structure, same logic, same functions
- Neither is used by gofr-iq (Vault is built from `lib/gofr-common/docker/Dockerfile.vault`)

### entrypoint-dev.sh (local vs common)
- **Not duplicates.** Local targets `/home/gofr/devroot/gofr-iq` with gofr-common submodule handling; common targets `/home/gofr/devroot/gofr-common`. Both are actively used by their respective `Dockerfile.dev`.

### build-base.sh (local vs common)
- **Not duplicates.** Local just tags `gofr-base:latest` -> `gofr-iq-base:latest`. Common actually builds `gofr-base` from `Dockerfile.base`.

### Dockerfile.dev (local vs common)
- **Not duplicates.** Local extends gofr-base for gofr-iq dev; common extends gofr-base for gofr-common dev. Different project directories, different entrypoints.

### docker-compose.yml vs compose.prod.yml
- **Byte-identical.** `docker-compose.yml` is the legacy name. All operational scripts use `compose.prod.yml`.

### docker-compose-test.yml vs compose.dev.yml
- **Byte-identical.** `docker-compose-test.yml` is the legacy name. All operational scripts use `compose.dev.yml`.

## Recommended Actions

### Safe to Delete (6 files)

1. **`docker-compose.yml`** -- exact duplicate of `compose.prod.yml`
2. **`docker-compose-test.yml`** -- exact duplicate of `compose.dev.yml`
3. **`entrypoint-vault.sh`** -- superseded by `lib/gofr-common/docker/entrypoint-vault.sh`, unreferenced
4. **`vault-config.hcl`** -- superseded by `lib/gofr-common/docker/vault-config.hcl`, unreferenced
5. **`vault-config.json`** -- JSON duplicate of vault-config.hcl, unreferenced
6. **`.vault-init.env.example`** -- orphaned, vault bootstrap handled by common scripts

### Stale References to Update After Deletion

| File | What to update |
|------|---------------|
| `docs/getting-started.md` | Change `docker-compose.yml` -> `compose.prod.yml` |
| `docs/reference/management-scripts.md` | Remove references to `docker-compose.yml`, `docker-compose-test.yml`, `vault-config.json` |
| `docs/reference/implementation-details.md` | Change `docker-compose.yml` -> `compose.prod.yml` |
| `docs/gofr_iq_auth_upgrade_implementation_plan.md` | Update compose file names |
| `scripts/check_version_compatibility.py` | Docstring says `docker-compose.yml` (line 147) |
| `scripts/run_tests.sh` | Comments reference `docker-compose-test.yml` (lines 5, 372) |
| `lib/gofr-common/scripts/restart_servers.sh` | Looks for `docker-compose.yml` (line 279) -- this is a gofr-common issue |
| `lib/gofr-common/docs/backup/backup.md` | References `docker-compose.yml` |
